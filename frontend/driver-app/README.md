# 司机界面启动指南

## 推荐方法：使用项目统一服务器（最简单）

在项目根目录运行：

```bash
npm run frontend
```

然后在浏览器中访问：
- **乘客端**: http://localhost:3001 或 http://localhost:3001/passenger
- **司机端**: http://localhost:3001/driver

这个服务器会同时提供乘客端和司机端的服务，使用同一个端口，非常方便！

## 方法二：使用Python HTTP服务器

### Windows:
```bash
# 在项目根目录运行
cd frontend
python -m http.server 8080
```

### Mac/Linux:
```bash
# 在项目根目录运行
cd frontend
python3 -m http.server 8080
```

然后访问：
- 乘客端: http://localhost:8080/passenger-app/
- 司机端: http://localhost:8080/driver-app/

**注意**: 使用Python服务器时，需要手动输入完整路径。推荐使用方法一。

## 方法三：直接打开HTML文件（不推荐）

1. 双击打开 `index.html` 文件

**注意**：由于浏览器安全限制，直接打开HTML文件时，MetaMask可能无法正常工作。建议使用方法一。

## 配置合约地址

首次使用时，需要配置合约地址：

1. 启动司机界面后，点击"连接钱包"
2. 如果还未配置合约地址，会弹出提示框
3. 输入 TrustFlowRide 合约地址（0x开头的42个字符）
4. 合约地址会保存在浏览器的 localStorage 中

**⚠️ 重要提示**：
- **所有司机和乘客必须使用同一个合约地址**
- 如果使用不同的合约地址，司机将看不到乘客创建的订单
- 合约地址保存在每个浏览器的 localStorage 中，不同浏览器需要各自配置一次
- 但配置时请确保使用**相同的**合约地址

**获取合约地址**：
- 如果已部署合约，运行 `npm run deploy:local` 会显示合约地址
- 合约地址也会保存在 `deployments/localhost-latest.json` 文件中
- 在乘客端配置的合约地址，应该与司机端使用相同的地址

## 使用步骤

1. **确保Hardhat本地节点正在运行**：
   ```bash
   npm run node
   ```

2. **确保已部署合约**（如果还没部署）：
   ```bash
   npm run deploy:local
   ```

3. **启动司机界面**（使用上述任一方法）

4. **连接钱包**：
   - 点击"连接钱包"按钮
   - 在MetaMask中确认连接
   - 如果首次使用，需要输入合约地址

5. **查看和接单**：
   - 界面会自动显示所有待接单的订单（Pending状态）
   - 点击"接单"按钮可以接受订单
   - 多个司机可以同时看到同一个订单，但只有第一个成功接单的司机能接受订单

## 故障排查

### 问题1：无法连接钱包
- 确保已安装MetaMask扩展
- 确保MetaMask已解锁
- 确保MetaMask连接到正确的网络（Hardhat Local Network，Chain ID: 1337）

### 问题2：看不到订单
- 确保Hardhat节点正在运行
- 确保合约已部署
- 确保有乘客创建了订单
- 检查浏览器控制台（F12）查看错误信息

### 问题3：接单失败
- 确保钱包中有足够的ETH支付gas费用
- 确保订单状态是Pending（不是已接单）
- 确保你不是该订单的创建者（乘客）

## 多司机测试

要测试多个司机抢单功能：

1. 在浏览器中打开两个或更多标签页
2. 每个标签页连接到不同的MetaMask账户（切换账户）
3. 在其中一个账户创建订单（使用乘客界面）
4. 在其他标签页中，司机可以看到订单并尝试接单
5. 第一个成功接单的司机会锁定订单，其他司机会看到"接单失败"的错误

## 网络配置

### 添加Hardhat本地网络到MetaMask

如果MetaMask还没有Hardhat本地网络：

1. 打开MetaMask
2. 点击网络选择器
3. 选择"添加网络"
4. 手动添加：
   - 网络名称：Hardhat Local Network
   - RPC URL：http://127.0.0.1:8545
   - 链ID：1337
   - 货币符号：ETH

或者使用项目中的自动网络切换功能（在连接钱包时自动添加）。
