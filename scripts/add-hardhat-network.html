<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·»åŠ  Hardhat æœ¬åœ°ç½‘ç»œåˆ° MetaMask</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        .info h3 {
            margin-top: 0;
            color: #1976d2;
        }
        .network-info {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .network-info strong {
            display: inline-block;
            width: 120px;
            color: #666;
        }
        button {
            background: #f6851b;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            font-weight: bold;
        }
        button:hover {
            background: #e5750f;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        #status.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
            display: block;
        }
        #status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
            display: block;
        }
        #status.info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196f3;
            display: block;
        }
        .steps {
            margin-top: 20px;
        }
        .steps ol {
            padding-left: 20px;
        }
        .steps li {
            margin: 10px 0;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ æ·»åŠ  Hardhat æœ¬åœ°ç½‘ç»œ</h1>
        
        <div class="info">
            <h3>ä½¿ç”¨è¯´æ˜</h3>
            <p>æ­¤å·¥å…·å°†è‡ªåŠ¨æ·»åŠ  Hardhat æœ¬åœ°å¼€å‘ç½‘ç»œåˆ°æ‚¨çš„ MetaMask é’±åŒ…ã€‚</p>
            <p><strong>é‡è¦ï¼š</strong>è¯·ç¡®ä¿ Hardhat èŠ‚ç‚¹æ­£åœ¨è¿è¡Œï¼ˆ<code>npm run node</code>ï¼‰</p>
        </div>

        <div class="network-info">
            <div><strong>ç½‘ç»œåç§°:</strong> Hardhat Localhost</div>
            <div><strong>RPC URL:</strong> http://127.0.0.1:8545</div>
            <div><strong>Chain ID:</strong> 1337 (0x539)</div>
            <div><strong>è´§å¸ç¬¦å·:</strong> ETH</div>
        </div>

        <button id="addBtn" onclick="addNetwork()">âœ¨ æ·»åŠ åˆ° MetaMask</button>

        <div id="status"></div>

        <div class="steps">
            <h3>æ‰‹åŠ¨æ·»åŠ æ­¥éª¤ï¼ˆå¦‚æœè‡ªåŠ¨æ·»åŠ å¤±è´¥ï¼‰</h3>
            <ol>
                <li>æ‰“å¼€ MetaMask</li>
                <li>ç‚¹å‡»ç½‘ç»œé€‰æ‹©å™¨ï¼ˆé¡¶éƒ¨æ˜¾ç¤ºç½‘ç»œåç§°çš„åœ°æ–¹ï¼‰</li>
                <li>ç‚¹å‡» "æ·»åŠ ç½‘ç»œ" æˆ– "Add Network"</li>
                <li>é€‰æ‹© "æ‰‹åŠ¨æ·»åŠ ç½‘ç»œ" æˆ– "Add a network manually"</li>
                <li>å¡«å†™ä¸Šè¿°ç½‘ç»œä¿¡æ¯</li>
                <li>ç‚¹å‡» "ä¿å­˜"</li>
            </ol>
        </div>
    </div>

    <script>
        async function addNetwork() {
            const btn = document.getElementById('addBtn');
            const status = document.getElementById('status');
            
            // æ£€æŸ¥ MetaMask æ˜¯å¦å®‰è£…
            if (typeof window.ethereum === 'undefined') {
                status.className = 'error';
                status.innerHTML = 'âŒ <strong>æœªæ£€æµ‹åˆ° MetaMask</strong><br>è¯·å…ˆå®‰è£… MetaMask æµè§ˆå™¨æ‰©å±•ï¼š<a href="https://metamask.io/" target="_blank">https://metamask.io/</a>';
                return;
            }

            btn.disabled = true;
            btn.textContent = 'å¤„ç†ä¸­...';
            status.className = 'info';
            status.innerHTML = 'â³ æ­£åœ¨æ·»åŠ ç½‘ç»œåˆ° MetaMask...';

            try {
                // å°è¯•æ·»åŠ ç½‘ç»œ
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: '0x539', // 1337 çš„åå…­è¿›åˆ¶
                        chainName: 'Hardhat Localhost',
                        nativeCurrency: {
                            name: 'ETH',
                            symbol: 'ETH',
                            decimals: 18
                        },
                        rpcUrls: ['http://127.0.0.1:8545'],
                        blockExplorerUrls: null
                    }]
                });

                status.className = 'success';
                status.innerHTML = 'âœ… <strong>æˆåŠŸï¼</strong><br>Hardhat æœ¬åœ°ç½‘ç»œå·²æ·»åŠ åˆ° MetaMaskã€‚è¯·æ£€æŸ¥ MetaMask æ˜¯å¦å·²åˆ‡æ¢åˆ°æ–°ç½‘ç»œã€‚';
                
                // å°è¯•åˆ‡æ¢ç½‘ç»œ
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x539' }]
                    });
                } catch (switchError) {
                    // å¦‚æœåˆ‡æ¢å¤±è´¥ï¼Œå¯èƒ½ç½‘ç»œå·²æ·»åŠ ä½†æœªåˆ‡æ¢ï¼Œè¿™æ˜¯æ­£å¸¸çš„
                    console.log('ç½‘ç»œå·²æ·»åŠ ï¼Œä½†å¯èƒ½éœ€è¦æ‰‹åŠ¨åˆ‡æ¢');
                }

            } catch (error) {
                console.error('æ·»åŠ ç½‘ç»œå¤±è´¥:', error);
                
                let errorMsg = 'âŒ <strong>æ·»åŠ å¤±è´¥</strong><br>';
                
                if (error.code === 4902) {
                    errorMsg += 'ç½‘ç»œå·²å­˜åœ¨ï¼Œä½†å¯èƒ½é…ç½®ä¸åŒã€‚è¯·æ‰‹åŠ¨æ£€æŸ¥ç½‘ç»œè®¾ç½®ã€‚';
                } else if (error.code === 4001) {
                    errorMsg += 'æ‚¨æ‹’ç»äº†æ·»åŠ ç½‘ç»œçš„è¯·æ±‚ã€‚è¯·é‡è¯•å¹¶ç‚¹å‡» "æ‰¹å‡†"ã€‚';
                } else if (error.message.includes('network')) {
                    errorMsg += 'ç½‘ç»œé”™è¯¯ï¼š' + error.message + '<br>è¯·ç¡®ä¿ Hardhat èŠ‚ç‚¹æ­£åœ¨è¿è¡Œï¼ˆ<code>npm run node</code>ï¼‰';
                } else {
                    errorMsg += error.message || 'æœªçŸ¥é”™è¯¯ã€‚è¯·å°è¯•æ‰‹åŠ¨æ·»åŠ ç½‘ç»œã€‚';
                }
                
                status.className = 'error';
                status.innerHTML = errorMsg;
            } finally {
                btn.disabled = false;
                btn.textContent = 'âœ¨ æ·»åŠ åˆ° MetaMask';
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ MetaMask
        window.addEventListener('load', () => {
            if (typeof window.ethereum === 'undefined') {
                document.getElementById('status').className = 'error';
                document.getElementById('status').innerHTML = 'âš ï¸ <strong>æœªæ£€æµ‹åˆ° MetaMask</strong><br>è¯·å…ˆå®‰è£…å¹¶è§£é” MetaMask é’±åŒ…ã€‚';
                document.getElementById('status').style.display = 'block';
            }
        });
    </script>
</body>
</html>

