/**
 * Translate Chinese comments to English in frontend files
 */

const fs = require('fs');
const path = require('path');

// Translation mapping for common Chinese comment patterns
const translations = {
    // Common patterns
    '首先定义': 'First define',
    '确保': 'Ensure',
    '这样即使': 'This prevents',
    '使用标志': 'Use flag',
    '占位符函数': 'Placeholder function',
    '会在': 'will be',
    '中替换': 'replaced in',
    '延迟重试': 'Retry with delay',
    '最多重试': 'up to',
    '次': 'retries',
    '保存真正的函数引用': 'Save reference to the real function',
    '调用真正的函数': 'Call the real function',
    '使用保存的引用': 'using saved reference',
    '避免递归': 'to avoid recursion',
    '立即返回': 'Return immediately',
    '避免执行后续代码': 'to avoid executing subsequent code',
    '如果已初始化': 'If initialized',
    '但占位符函数还在': 'but placeholder function still exists',
    '说明': 'indicates',
    '可能没有正确替换': 'may not have been replaced correctly',
    '尝试调用': 'Try calling',
    '简单的后备实现': 'Simple fallback implementation',
    '全局变量': 'Global variables',
    '合约地址': 'Contract addresses',
    '从': 'from',
    '加载': 'Load',
    '或': 'or',
    '如果': 'If',
    '已加载': 'is loaded',
    '优先使用': 'prioritize using',
    '将': 'Expose',
    '暴露到': 'to',
    '全局': 'global scope',
    '合约ABI': 'Contract ABI',
    '简化版': 'simplified version',
    '只包含必要函数': 'only includes necessary functions',
    '使用': 'using',
    '切换菜单': 'Toggle menu',
    '必须在': 'must be in',
    '全局作用域': 'global scope',
    '切换语言菜单': 'Toggle language menu',
    '选择语言': 'Select language',
    '更新语言选项状态': 'Update language option status',
    '更新选中标记': 'Update selected marker',
    '更新当前语言显示': 'Update current language display',
    '关闭语言选项': 'Close language options',
    '更新页面文本': 'Update page text',
    '更新': 'Update',
    '选项文本': 'option text',
    '如果选项已存在': 'if options already exist',
    '显示关于信息': 'Show about information',
    '显示帮助信息': 'Show help information',
    '底部导航功能': 'Bottom navigation functions',
    '已在上面重新定义': 'already redefined above',
    '切换到': 'Switch to',
    '订单列表视图': 'order list view',
    '隐藏其他视图': 'Hide other views',
    '显示': 'show',
    '视图': 'view',
    '滚动到顶部': 'Scroll to top',
    '加载订单数据': 'Load order data',
    '延迟一点': 'Delay a bit',
    '确保 DOM 已准备好': 'to ensure DOM is ready',
    '更新菜单活动状态': 'Update menu active status',
    '从菜单导航': 'Navigate from menu',
    '切换到个人资料视图': 'Switch to profile view',
    '隐藏其他视图，显示资料视图': 'Hide other views, show profile view',
    '加载用户资料': 'Load user profile',
    '切换到合约视图': 'Switch to contract view',
    '创建订单': 'create order',
    '显示合约视图': 'Show contract view',
    '隐藏其他视图': 'Hide other views',
    'ETH 到 USD 转换函数': 'ETH to USD conversion function',
    '使用固定汇率': 'using fixed exchange rate',
    '实际项目中应该从API获取实时汇率': 'in actual project should get real-time exchange rate from API',
    '这里使用固定汇率': 'Here using fixed exchange rate',
    '可根据实际情况修改': 'can be modified according to actual situation',
    '在IIFE顶部声明一次': 'Declare once at the top of IIFE',
    '供所有函数使用': 'for use by all functions',
    '可以通过API获取实时汇率': 'can get real-time exchange rate via API',
    '暴露到全局，供外部函数使用': 'Expose to global scope for use by external functions',
    '筛选订单': 'Filter orders',
    '更新筛选标签状态': 'Update filter tab status',
    '高亮显示当前选中的Tab': 'Highlight currently selected tab',
    '找到对应的标签并激活': 'Find corresponding tab and activate',
    '使用蓝色文字和下划线': 'using blue text and underline',
    '如果是统计视图': 'If it is statistics view',
    '显示统计图表': 'show statistics chart',
    '否则': 'Otherwise',
    '隐藏统计视图': 'Hide statistics view',
    '显示订单列表': 'show order list',
    '如果订单列表为空或未加载': 'If order list is empty or not loaded',
    '先加载订单': 'load orders first',
    '加载完成后再次筛选': 'Filter again after loading completes',
    '确保 Orders 视图已显示': 'Ensure Orders view is displayed',
    '给一点时间': 'Give some time',
    '让 DOM 渲染': 'for DOM to render',
    '重新渲染订单列表': 'Re-render order list',
    '使用最新的订单数据': 'using latest order data',
    '统计各状态的订单': 'Count orders by status',
    '确保状态是数字类型': 'Ensure status is numeric type',
    '调试': 'Debug',
    '显示前几个订单的状态': 'Show status of first few orders',
    '确保 Orders 视图已显示': 'Ensure Orders view is displayed',
    '使用已有的': 'using existing',
    '变量': 'variable',
    '渲染日订单统计图表': 'Render daily order statistics chart',
    '使用演示数据': 'using demo data',
    '生成过去14天的演示数据': 'Generate demo data for past 14 days',
    '生成随机订单数': 'Generate random number of orders',
    '之间': 'between',
    '计算最大值用于缩放': 'Calculate maximum value for scaling',
    '生成图表HTML': 'Generate chart HTML',
    '暴露函数到全局': 'Expose function to global scope',
    '数据变化检测变量': 'Data change detection variable',
    '暴露到全局，供自动刷新使用': 'Expose to global scope for auto-refresh use',
    '记录已渲染的订单ID集合': 'Record set of rendered order IDs',
    '用于增量更新': 'for incremental update',
    '避免闪烁': 'avoid flickering',
    '防止并发加载': 'Prevent concurrent loading',
    '如果 Orders 视图的元素不存在': 'If Orders view element does not exist',
    '仍然继续加载订单数据': 'still continue loading order data',
    '数据会保存到': 'data will be saved to',
    '这样即使视图未显示': 'so even if view is not displayed',
    '订单数据也会被正确加载和保存': 'order data will still be correctly loaded and saved',
    '不返回，继续执行': 'Do not return, continue execution',
    '以加载和保存订单数据': 'to load and save order data',
    '显示友好的提示信息': 'Display friendly message',
    '从合约获取订单ID列表': 'Get order ID list from contract',
    '获取所有历史订单': 'Get all historical orders',
    '包括所有状态': 'including all statuses',
    '在 try 块外声明': 'Declare outside try block',
    '首先验证合约地址是否有代码': 'First verify if contract address has code',
    '通过后端API获取订单列表': 'Get order list through backend API',
    '替代直接链上查询': 'Alternative to direct on-chain query',
    '将订单对象数组转换为订单ID数组': 'Convert order object array to order ID array',
    '用于后续处理': 'for subsequent processing',
    '提供详细的错误诊断': 'Provide detailed error diagnosis',
    '检查是否是': 'Check if it is',
    '错误': 'error',
    '不抛出错误': "Don't throw error",
    '显示友好的错误信息': 'display friendly error message',
    '其他错误，抛出': 'Other errors, throw',
    '订单数据已经从API获取': 'Order data has already been obtained from API',
    '直接处理即可': 'process directly',
    'API返回的数据已经是格式化后的': 'API returned data is already formatted',
    '直接使用': 'use directly',
    'API返回的数据格式可能不同': 'API returned data format may differ',
    '需要适配': 'needs adaptation',
    '使用全局定义的常量': 'Use globally defined constant',
    '重要': 'Important',
    '用于后续筛选': 'for subsequent filtering',
    '过滤掉null值': 'Filter out null values',
    '并按时间倒序排列': 'and sort by time in descending order',
    '最新的在前': 'latest first',
    '统计各状态的订单数量': 'Count number of orders by status',
    '辅助函数': 'Helper function',
    '确保状态被正确解析为数字': 'Ensure status is correctly parsed as number',
    '合并已存在的订单': 'Merge existing orders',
    '避免覆盖刚创建的订单': 'avoid overwriting newly created orders',
    '注意': 'Note',
    '刷新页面后': 'After page refresh',
    '会丢失': 'will be lost',
    '所以主要使用从链上获取的订单': 'so mainly use orders obtained from chain',
    '合并订单': 'Merge orders',
    '避免重复': 'avoid duplicates',
    '先添加已存在的订单': 'First add existing orders',
    '可能包含刚创建但未确认的': 'may include newly created but unconfirmed',
    '确保状态被正确解析': 'Ensure status is correctly parsed',
    '更新为数字类型': 'Update to numeric type',
    '然后用从链上获取的订单更新': 'Then update with orders obtained from chain',
    '这些是已确认的': 'these are confirmed',
    '优先级更高': 'higher priority',
    '这会覆盖旧的状态': 'This will overwrite old status',
    '转换回数组并排序': 'Convert back to array and sort',
    '调试：显示合并后的订单状态': 'Debug: Show merged order status',
    '刷新页面后，直接使用从链上获取的订单': 'After page refresh, directly use orders obtained from chain',
    '这是唯一的数据源': 'This is the only data source',
    '检查数据是否真的变化了': "Check if data has actually changed",
    '避免不必要的重新渲染': "avoid unnecessary re-rendering",
    '更新UI': 'Update UI',
    '如果视图元素存在': 'if view element exists',
    '只有在Orders视图显示时才渲染订单列表': 'Only render order list when Orders view is displayed',
    '获取当前选中的筛选器': 'Get currently selected filter',
    '如果没有选中的标签': 'If no tab is selected',
    '默认选择': 'default to',
    '统计订单状态用于调试': 'Count order status for debugging',
    '增量更新': 'Incremental update',
    '检查哪些订单已经渲染过': 'Check which orders have been rendered',
    '检查是否有新订单需要添加': 'Check if there are new orders to add',
    '或已有订单需要更新': 'or existing orders to update',
    '乘客确认完成订单': 'Passenger confirm complete order',
    '调用': 'Call',
    '使用': 'using',
    '作为': 'as',
    '到期模拟': 'maturity simulation',
    '获取订单信息': 'Get order information',
    '从合约获取最新状态': 'Get latest status from contract',
    '确保 status 是数字类型': 'Ensure status is numeric type',
    '确保 rideStatus 是数字类型': 'Ensure rideStatus is numeric type',
    '枚举值': 'Enum values',
    '注意：Solidity enum 从 0 开始': 'Note: Solidity enum starts from 0',
    '但这里我们需要正确映射': 'but here we need to map correctly',
    '实际上': 'Actually',
    '但根据合约定义': 'But according to contract definition',
    '所以索引应该是': 'So the index should be',
    '检查订单状态': 'Check order status',
    '允许': 'Allow',
    '状态': 'status',
    '订单状态不正确': 'Invalid order status',
    '订单必须是': 'Order must be in',
    '状态才能完成': 'status to complete',
    '订单尚未被司机接单': 'Order has not been accepted by driver yet',
    '无法完成': 'Cannot complete',
    '检查订单是否已经是': 'Check if order is already in',
    '获取当前账户余额': 'Get current account balance',
    '交易前': 'before transaction',
    '无法获取交易前余额': 'Unable to get balance before transaction',
    '如果订单已经是 Completed 状态': "If order is already in Completed status",
    '调用 settle 函数来结算资金': 'Call settle function to settle funds',
    '作为到期模拟': 'as maturity simulation',
    '检查是否已经结算': 'Check if already settled',
    '从合约定义': 'From contract definition',
    '如果已经是 SETTLED': "If already SETTLED",
    '说明已经结算完成': 'indicates settlement is complete',
    '订单已结算': 'Order already settled',
    '验证转账信息': 'Verify transfer information',
    '查询': 'Query',
    '事件': 'event',
    '查询最近': 'Query recent',
    '个区块': 'blocks',
    '找到': 'Found',
    '检查司机当前余额': 'Check driver current balance',
    '如果可能': 'if possible',
    '未找到': 'Not found',
    '但订单状态显示已结算': "but order status shows settled",
    '这可能表示转账失败但状态被错误更新': "This may indicate transfer failed but status was incorrectly updated",
    '请检查交易历史或联系管理员': 'Please check transaction history or contact administrator',
    '查询事件失败': 'Failed to query events',
    '无法验证转账详情': 'Unable to verify transfer details',
    '请检查司机端余额或联系管理员': 'Please check driver balance or contact administrator',
    '如果是 AWAITING_SETTLEMENT': "If in AWAITING_SETTLEMENT",
    '可以结算': 'can settle',
    '订单状态不正确': 'Invalid order status',
    '订单必须是 AWAITING_SETTLEMENT 状态才能结算': 'Order must be in AWAITING_SETTLEMENT status to settle',
    '当前状态': 'Current status',
    '订单已经结算完成': 'Order already settled',
    '无需再次结算': 'No need to settle again',
    '直接调用 settle': 'Directly call settle',
    '不再检查 rideStatus': 'no longer check rideStatus',
    '因为这是模拟流程': 'because this is a simulation process',
    '如果 rideStatus 不是 AWAITING_SETTLEMENT': "If rideStatus is not AWAITING_SETTLEMENT",
    'settle 函数会在合约层面检查': 'settle function will check at contract level',
    '确认结算订单': 'Confirm settling order',
    '订单已完成': 'Order is completed',
    '现在将结算资金给司机': 'funds will now be settled to driver',
    '模拟 complete order 流程': 'simulating complete order process',
    '用户取消了结算操作': 'User cancelled settlement operation',
    '调用 settle 函数': 'Call settle function',
    '模拟': 'simulating',
    '调用前状态检查': 'Status check before calling',
    '调用 settle 失败': 'Failed to call settle',
    '错误详情': 'Error details',
    '如果 settle 失败': "If settle fails",
    '提供详细的错误信息': 'Provide detailed error information',
    '无法结算订单': 'Cannot settle order',
    '当前 rideStatus': 'Current rideStatus',
    '订单必须是 AWAITING_SETTLEMENT (5) 状态才能结算': 'Order must be in AWAITING_SETTLEMENT (5) status to settle',
    '合约余额不足': 'Insufficient contract balance',
    '请联系管理员': 'Please contact administrator',
    '结算订单失败': 'Failed to settle order',
    '请检查订单状态和合约余额': 'Please check order status and contract balance',
    '等待交易确认': 'Wait for transaction confirmation',
    '交易已确认': 'Transaction confirmed',
    '区块号': 'Block number',
    '交易回执中的所有事件': 'All events in transaction receipt',
    '检查 PaymentReleased 或 RideSettled 事件': 'Check PaymentReleased or RideSettled events',
    '事件已发出': 'Event emitted',
    '订单ID': 'Order ID',
    '司机地址': 'Driver address',
    '司机金额': 'Driver amount',
    '平台费用': 'Platform fee',
    '未找到 PaymentReleased 事件': 'PaymentReleased event not found',
    'RideSettled 事件已发出': 'RideSettled event emitted',
    '结算时间': 'Settlement time',
    '再次获取订单状态': 'Get order status again',
    '确认已结算': 'Confirm settled',
    '应该是 SETTLED (6)': 'Should be SETTLED (6)',
    '验证司机地址和金额': 'Verify driver address and amount',
    '转账验证信息': 'Transfer verification information',
    '司机应收到金额': 'Driver should receive amount',
    '检查司机当前余额': 'Check driver current balance',
    '检查交易详情': 'Check transaction details',
    '验证转账是否真的发生了': 'Verify if transfer actually occurred',
    '交易已成功确认': 'Transaction successfully confirmed',
    '检查交易中的转账记录': 'Check transfer records in transaction',
    '交易详情': 'Transaction details',
    '交易哈希': 'Transaction hash',
    'Gas 使用量': 'Gas used',
    '交易状态': 'Transaction status',
    '成功': 'success',
    '检查司机的历史余额变化': 'Check driver historical balance changes',
    '通过查询多个区块': 'by querying multiple blocks',
    '检查司机余额变化': 'Check driver balance changes',
    '在结算区块前后查询余额': 'Query balance before and after settlement block',
    '获取区块时间戳': 'Get block timestamp',
    '注意：我们无法直接查询历史余额': "Note: We cannot directly query historical balance",
    '但可以验证当前余额': "but can verify current balance",
    '司机当前余额': 'Driver current balance',
    '应该收到的金额': 'Amount that should be received',
    '计算预期的余额': 'Calculate expected balance',
    '如果收到': 'if received',
    '预期余额': 'Expected balance',
    '检查转账日志': 'Check transfer logs',
    '通过事件的 topics 和 data': 'through event topics and data',
    '转账验证': 'Transfer verification',
    '如果司机余额增加了': "If driver balance increased",
    '说明转账成功': 'indicates transfer succeeded',
    '注意：MetaMask 可能不显示合约内部转账的记录': 'Note: MetaMask may not show internal contract transfer records',
    '请直接检查司机钱包的余额变化': 'Please directly check driver wallet balance changes',
    '而不是交易记录': 'rather than transaction records',
    '无法检查余额变化': 'Unable to check balance changes',
    '提示信息': 'Tip information',
    '重要提示': 'Important note',
    'MetaMask 通常不显示合约内部转账的交易记录': "MetaMask usually doesn't show internal contract transfer transaction records",
    '即使转账成功': 'Even if transfer succeeds',
    '司机在 MetaMask 的交易历史中可能看不到': "driver may not see it in MetaMask transaction history",
    '请直接检查司机钱包的余额是否增加了': 'Please directly check if driver wallet balance increased',
    '如果余额增加了': "If balance increased",
    '说明转账成功': 'indicates transfer succeeded',
    '验证方法': 'Verification method',
    '记录转账前的余额': 'Record balance before transfer',
    '记录转账后的余额': 'Record balance after transfer',
    '检查余额是否增加了': 'Check if balance increased',
    '如果余额没有增加': "If balance didn't increase",
    '请联系管理员检查交易': 'Please contact administrator to check transaction',
    '显示详细提示给用户': 'Display detailed tips to user',
    '结算成功': 'Settlement successful',
    '转账详情': 'Transfer details',
    'MetaMask 可能不显示合约内部转账的交易记录': "MetaMask may not show internal contract transfer transaction records",
    '请直接检查司机钱包余额是否增加了': 'Please directly check if driver wallet balance increased',
    '如果余额增加了，说明转账成功': "If balance increased, transfer was successful",
    '交易状态异常': 'Transaction status abnormal',
    '无法获取交易详情': 'Unable to get transaction details',
    '无法检查司机余额': 'Unable to check driver balance',
    '未找到 PaymentReleased 事件，但订单状态显示已结算': "PaymentReleased event not found, but order status shows settled",
    '这可能表示转账有问题': "This may indicate there is a problem with the transfer",
    '请检查交易详情': 'Please check transaction details',
    '无法获取结算后的订单状态': 'Unable to get order status after settlement',
    '等待 settle 交易确认失败': 'Failed to wait for settle transaction confirmation',
    '如果订单是 PickedUp': "If order is PickedUp",
    '调用 completeOrder 函数': 'Call completeOrder function',
    '使用 estimatedFare 作为 actualFare': 'Use estimatedFare as actualFare',
    '作为到期模拟': 'as maturity simulation',
    '确认完成订单': 'Confirm completing order',
    '订单金额': 'Order amount',
    '完成后将自动结算资金给司机': 'After completion, funds will be automatically settled to driver',
    '用户取消了完成订单操作': 'User cancelled order completion operation',
    '调用 completeOrder 函数': 'Call completeOrder function',
    '作为到期模拟': 'as maturity simulation',
    'completeOrder 交易已发送': 'completeOrder transaction sent',
    '哈希': 'hash',
    '完成订单失败': 'Failed to complete order',
    '交易已提交，等待确认': 'Transaction submitted, waiting for confirmation',
    '等待 completeOrder 交易确认': 'Wait for completeOrder transaction confirmation',
    'completeOrder 交易已确认': 'completeOrder transaction confirmed',
    '未找到 PaymentReleased 事件': "PaymentReleased event not found",
    'completeOrder 可能已自动结算': "completeOrder may have automatically settled",
    '等待 completeOrder 交易确认失败': 'Failed to wait for completeOrder transaction confirmation',
    '显示成功消息': 'Display success message',
    '只有在两个分支都成功时才显示': 'Only display when both branches succeed',
};

function translateComment(comment) {
    // Remove leading/trailing whitespace and comment markers
    let text = comment.trim();
    
    // Remove // markers
    if (text.startsWith('//')) {
        text = text.substring(2).trim();
    }
    
    // Try to find translations
    for (const [chinese, english] of Object.entries(translations)) {
        if (text.includes(chinese)) {
            text = text.replace(new RegExp(chinese, 'g'), english);
        }
    }
    
    return text;
}

// File to process
const filePath = path.join(__dirname, '../frontend/passenger-app/index.html');

console.log('Reading file...');
const content = fs.readFileSync(filePath, 'utf8');

// Find all Chinese comments
const chineseCommentRegex = /^\s*\/\/\s*[^\n]*[一-龟][^\n]*/gm;
const matches = content.match(chineseCommentRegex);

if (matches) {
    console.log(`Found ${matches.length} Chinese comments`);
    console.log('First 10 matches:');
    matches.slice(0, 10).forEach((match, i) => {
        console.log(`${i + 1}. ${match.trim()}`);
    });
} else {
    console.log('No Chinese comments found');
}

console.log('\nNote: This script only identifies Chinese comments.');
console.log('Manual translation is required for accurate results.');
